"0","library(readxl)"
"0","library(dplyr)"
"0",""
"0","cog_sc_fc_y <- read.csv(""Data/cog_sc_fc_y.csv"")"
"0","traits_meta <- read_excel(""Data/traits/175traits/Details_175_Traits.xlsx"")"
"0",""
"0","su_vars_all <- traits_meta %>%"
"0","  filter(Category == ""Substance Use"") %>%"
"0","  pull(Column_Header) %>%"
"0","  unique()"
"0",""
"0","# Keep only those that actually exist in cog_sc_fc_y"
"0","su_vars <- intersect(su_vars_all, names(cog_sc_fc_y))"
"0",""
"0","# 3. Helper to compute PC1 across given columns"
"0","get_pc1 <- function(df, cols) {"
"0","  cols <- intersect(cols, names(df))"
"0","  if (length(cols) == 0) {"
"0","    return(rep(NA_real_, nrow(df)))"
"0","  }"
"0","  x <- df[, cols, drop = FALSE]"
"0","  # Drop all-NA columns"
"0","  non_all_na <- colSums(!is.na(x)) > 0"
"0","  x <- x[, non_all_na, drop = FALSE]"
"0","  if (ncol(x) == 0) {"
"0","    return(rep(NA_real_, nrow(df)))"
"0","  }"
"0","  # Median-impute NAs per column"
"0","  for (j in seq_len(ncol(x))) {"
"0","    nas <- is.na(x[, j])"
"0","    if (any(nas)) {"
"0","      med <- median(x[, j], na.rm = TRUE)"
"0","      x[nas, j] <- med"
"0","    }"
"0","  }"
"0","  # PCA on standardized columns"
"0","  pc <- prcomp(x, center = TRUE, scale. = TRUE)"
"0","  score <- pc$x[, 1]  # PC1"
"0","  return(score)"
"0","}"
"0",""
"0","# 4. Compute general substance-use severity score"
"0","cog_sc_fc_y$Y_general <- get_pc1(cog_sc_fc_y, su_vars)"
"0",""
"0","summary(cog_sc_fc_y$Y_general)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","-4.4185 "
"1","-2.2920 "
"1","-0.7686 "
"1"," 0.0000 "
"1"," 1.6208 "
"1","13.5964 "
"1","
"
"0","# 5. Save back to the same CSV (or change name if you prefer a new file)"
"0","write.csv(cog_sc_fc_y, ""Data/cog_sc_fc_y.csv"", row.names = FALSE)"
"0","cat(""Updated cog_sc_fc_y.csv with Y_general column.\n"")"
"1","Updated cog_sc_fc_y.csv with Y_general column.
"
